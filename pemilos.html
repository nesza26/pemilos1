<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Pemilos SMKN 1 Ampelgading</title>
  <style>
    :root{
      --purple-700:#6F56B9;
      --purple-600:#7B5DBB;
      --purple-500:#8A6FD1;
      --purple-300:#B9A7E8;
      --purple-200:#D6CBF5;
      --purple-100:#F3EEFF;
      --bg:#FBF9FF;
      --text:#241B3C;
      --muted:#6F678A;
      --shadow:0 14px 30px rgba(111,86,185,.18);
      --ring:0 0 0 3px rgba(138,111,209,.22);
      --success:#44C49A;
      --danger:#F26D6D;
    }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0; font-family: "Inter", system-ui, Arial, sans-serif; color:var(--text);
      background:
        radial-gradient(1000px 500px at 120% -10%, #EDE8FF 0%, transparent 50%) fixed,
        linear-gradient(180deg, var(--bg), #FFFFFF 50%);
    }

    /* Header */
    header{padding:28px 18px 8px; text-align:center}
    .brand{
      display:inline-flex; align-items:center; gap:14px;
      padding:14px 18px; border-radius:16px; background:linear-gradient(135deg, #fff, var(--purple-100));
      box-shadow: var(--shadow);
    }
    .logo{
      width:44px; height:44px; border-radius:12px; display:grid; place-items:center;
      color:#fff; font-weight:800; letter-spacing:.6px;
      background:conic-gradient(from 20deg, var(--purple-600), var(--purple-300), var(--purple-600));
      text-shadow:0 1px 1px rgba(0,0,0,.15);
    }
    h1{margin:12px 0 6px; font-size:1.7rem}
    .subtitle{margin:0; color:var(--muted); font-size:.98rem}

    /* Layout */
    main{max-width:1080px; margin:26px auto 50px; padding:0 20px; display:grid; grid-template-columns:1.25fr .95fr; gap:26px}
    @media (max-width:980px){main{grid-template-columns:1fr}}

    /* Card */
    .card{background:#fff; border-radius:20px; box-shadow:var(--shadow); overflow:hidden}
    .card-header{
      padding:18px 22px; display:flex; justify-content:space-between; align-items:center;
      background:linear-gradient(135deg, var(--purple-100), #fff 70%); border-bottom:1px solid var(--purple-200);
    }
    .card-title{font-weight:800}
    .hint{color:var(--muted); font-size:.92rem}

    /* Candidates */
    .candidates{display:grid; grid-template-columns:repeat(3,1fr); gap:16px; padding:20px}
    @media (max-width:860px){.candidates{grid-template-columns:1fr}}
    .cand{
      border:1px solid var(--purple-200); border-radius:16px; padding:16px;
      background:linear-gradient(180deg, #fff, var(--purple-100) 200%);
      position:relative; transition:transform .15s ease, box-shadow .15s ease;
    }
    .cand:hover{transform:translateY(-2px); box-shadow:0 10px 20px rgba(127,97,194,.18)}
    .cand-head{display:flex; align-items:center; gap:12px; margin-bottom:10px}
    .avatar{
      width:50px; height:50px; border-radius:12px; display:grid; place-items:center; color:#fff; font-weight:800;
      background:linear-gradient(135deg, var(--purple-600), var(--purple-300)); box-shadow:0 8px 16px rgba(127,97,194,.35);
    }
    .cand-name{font-weight:800}
    .cand-number{color:var(--muted); font-size:.9rem}
    .stat{display:flex; justify-content:space-between; align-items:center; margin-top:8px; color:var(--muted); font-size:.92rem}
    .cand-prog{margin-top:12px; height:9px; border-radius:10px; background:#ECE7FF; overflow:hidden}
    .cand-bar{height:100%; width:0%; background: linear-gradient(135deg, var(--purple-500), var(--purple-300)); border-radius:10px; transition:width .35s ease}
    .cand-actions{display:flex; gap:10px; margin-top:14px}
    .btn{
      border:0; border-radius:12px; padding:10px 14px; font-weight:700; cursor:pointer;
      background:var(--purple-600); color:#fff; box-shadow:0 8px 16px rgba(127,97,194,.25);
      transition:filter .15s ease, transform .06s ease;
    }
    .btn:active{transform:scale(.98)}
    .btn.secondary{background:#fff; color:var(--purple-600); border:1.5px solid var(--purple-300)}
    .small{font-size:.9rem; padding:8px 12px}

    /* Panel Hasil */
    .panel{background:#fff; border-radius:20px; box-shadow:var(--shadow); padding:18px 20px}
    .panel h3{margin:8px 0 6px}
    .kpi{display:grid; grid-template-columns:repeat(3,1fr); gap:12px; margin:10px 0 18px}
    @media (max-width:820px){.kpi{grid-template-columns:1fr 1fr}}
    .pill{padding:12px; border:1px solid var(--purple-200); border-radius:14px; background:linear-gradient(180deg,#fff,var(--purple-100) 220%)}
    .pill .label{color:var(--muted); font-size:.85rem}
    .pill .value{font-weight:800; font-size:1.2rem}
    .chart-wrap{display:grid; gap:8px}
    canvas{width:100%; max-height:280px; background:#fff; border:1px solid var(--purple-200); border-radius:16px}

    /* Footer */
    footer{text-align:center; color:var(--muted); padding:18px 20px; margin-top:24px}
    .note{font-size:.88rem; color:var(--muted); background:var(--purple-100); border:1px dashed var(--purple-300); padding:10px 12px; border-radius:12px; margin:10px 20px}
    .toast{
      position:fixed; bottom:20px; left:50%; transform:translateX(-50%);
      padding:10px 14px; border-radius:12px; color:#fff; font-weight:700; box-shadow:0 10px 20px rgba(0,0,0,.18); z-index:9999;
    }
  </style>
</head>
<body>
  <header>
    <div class="brand">
      <div class="logo">
  <img src="logo-smkn1.jpg" style="width:48px; height:48px; border-radius:12px;">
</div>
      <div>
        <h1>Pemilihan Ketua OSIS — SMKN 1 Ampelgading</h1>
      </div>
    </div>
  </header>

  <main>
    <section class="card" aria-labelledby="kandidat">
      <div class="card-header">
        <div class="card-title" id="kandidat">Kandidat</div>
        <div class="hint">Gunakan tombol “+1 suara” untuk memilih satu calon osis.</div>
      </div>

      <div class="candidates">
        <div class="cand" data-id="1">
          <div class="cand-head">
            <div class="avatar">01</div>
            <div>
              <div class="cand-name">Ariny</div>
              <div class="cand-number">No. Urut 1 • Visi: OSIS Inklusif</div>
            </div>
          </div>
          <div class="stat">
            <div>Total suara</div>
            <div><strong id="count-1">0</strong> (<span id="percent-1">0%</span>)</div>
          </div>
          <div class="cand-prog"><div class="cand-bar" id="bar-1"></div></div>
          <div class="cand-actions">
            <button class="btn small" onclick="vote(1)">+1 suara</button>
            <button class="btn secondary small" onclick="setForm(1)">Pilih di form</button>
          </div>
        </div>

        <div class="cand" data-id="2">
          <div class="cand-head">
            <div class="avatar">02</div>
            <div>
              <div class="cand-name">Kaka</div>
              <div class="cand-number">No. Urut 2 • Visi: Disiplin & Prestasi</div>
            </div>
          </div>
          <div class="stat">
            <div>Total suara</div>
            <div><strong id="count-2">0</strong> (<span id="percent-2">0%</span>)</div>
          </div>
          <div class="cand-prog"><div class="cand-bar" id="bar-2"></div></div>
          <div class="cand-actions">
            <button class="btn small" onclick="vote(2)">+1 suara</button>
            <button class="btn secondary small" onclick="setForm(2)">Pilih di form</button>
          </div>
        </div>

        <div class="cand" data-id="3">
          <div class="cand-head">
            <div class="avatar">03</div>
            <div>
              <div class="cand-name">Bagus</div>
              <div class="cand-number">No. Urut 3 • Visi: Kreatif & Kolaboratif</div>
            </div>
          </div>
          <div class="stat">
            <div>Total suara</div>
            <div><strong id="count-3">0</strong> (<span id="percent-3">0%</span>)</div>
          </div>
          <div class="cand-prog"><div class="cand-bar" id="bar-3"></div></div>
          <div class="cand-actions">
            <button class="btn small" onclick="vote(3)">+1 suara</button>
            <button class="btn secondary small" onclick="setForm(3)">Pilih di form</button>
          </div>
        </div>
      </div>
    </section>

    <aside class="panel" aria-labelledby="hasil">
      <h3 id="hasil">Hasil sementara</h3>

      <div class="kpi">
        <div class="pill">
          <div class="label">Total suara</div>
          <div class="value" id="totalVotes">0</div>
        </div>
        <div class="pill">
          <div class="label">Kandidat unggul</div>
          <div class="value" id="leader">—</div>
        </div>
        <div class="pill">
          <div class="label">Persentase tertinggi</div>
          <div class="value" id="topPercent">0%</div>
        </div>
      </div>

      <div class="chart-wrap">
        <canvas id="chart" height="260" aria-label="Diagram batang hasil"></canvas>
      </div>

      <div class="note">
      <center>hasil pemilihan osis</center>
      </div>

      <div style="display:grid; grid-template-columns:repeat(3,1fr); gap:12px; margin-top:10px">
        <div>
          <label for="manual-1" style="font-weight:700">Ariny</label>
          <input id="manual-1" type="number" min="0" value="0" oninput="manualSet(1, this.value)"
                 style="width:100%; border:1.5px solid var(--purple-200); border-radius:12px; padding:10px 12px; outline:none"
                 onfocus="this.style.boxShadow='var(--ring)'" onblur="this.style.boxShadow='none'">
        </div>
        <div>
          <label for="manual-2" style="font-weight:700">Kaka</label>
          <input id="manual-2" type="number" min="0" value="0" oninput="manualSet(2, this.value)"
                 style="width:100%; border:1.5px solid var(--purple-200); border-radius:12px; padding:10px 12px; outline:none"
                 onfocus="this.style.boxShadow='var(--ring)'" onblur="this.style.boxShadow='none'">
        </div>
        <div>
          <label for="manual-3" style="font-weight:700">Bagus</label>
          <input id="manual-3" type="number" min="0" value="0" oninput="manualSet(3, this.value)"
                 style="width:100%; border:1.5px solid var(--purple-200); border-radius:12px; padding:10px 12px; outline:none"
                 onfocus="this.style.boxShadow='var(--ring)'" onblur="this.style.boxShadow='none'">
        </div>
      </div>

      <div style="display:flex; gap:10px; margin-top:14px; flex-wrap:wrap">
        <button class="btn" onclick="resetAll()">Reset</button>
        <button class="btn secondary" onclick="saveLocal()">Simpan ke perangkat</button>
        <button class="btn" style="background:var(--success)" onclick="exportCSV()">Unduh CSV</button>
      </div>
    </aside>
  </main>

  <footer>© 2025-2026 Pemilos SMKN 1 Ampelgading.</footer>

  <script>
    const state = {counts:{1:0,2:0,3:0}};

    // Init from localStorage
    (function init(){
      const raw = localStorage.getItem('pemilos_simple');
      if(raw){
        try{
          const data = JSON.parse(raw);
          if(data && data.counts) state.counts = data.counts;
        }catch(e){}
      }
      refresh();
    })();

    function vote(id){
      state.counts[id] = (state.counts[id]||0) + 1;
      refresh(); toast('+1 suara untuk kandidat ' + id, 'ok');
      document.getElementById('manual-'+id).value = state.counts[id];
    }
    function manualSet(id, val){
      const n = Math.max(0, Number(val||0));
      state.counts[id] = n;
      refresh();
    }
    function resetAll(){
      state.counts = {1:0,2:0,3:0};
      ['manual-1','manual-2','manual-3'].forEach(i=>document.getElementById(i).value=0);
      refresh(); toast('Data direset', 'warn');
    }
    function saveLocal(){
      localStorage.setItem('pemilos_simple', JSON.stringify(state));
      toast('Tersimpan ke perangkat', 'ok');
    }
    function exportCSV(){
      const header = ['kandidat','suara'];
      const rows = [[1,state.counts[1]],[2,state.counts[2]],[3,state.counts[3]]];
      const csv = [header.join(','), ...rows.map(r=>r.join(','))].join('\n');
      const blob = new Blob([csv], {type:'text/csv;charset=utf-8;'});
      const url = URL.createObjectURL(blob);
      const a = document.createElement('a');
      a.href = url; a.download = 'rekap_pemilos_smkn1.csv'; a.click();
      setTimeout(()=>URL.revokeObjectURL(url), 500);
    }

    function setForm(id){
      const el = document.getElementById('manual-'+id);
      el.focus(); el.style.boxShadow='var(--ring)';
      setTimeout(()=> el.style.boxShadow='none', 700);
    }

    function refresh(){
      const total = Object.values(state.counts).reduce((a,b)=>a+b,0);
      for(const id of [1,2,3]){
        const c = state.counts[id]||0;
        const pct = total ? Math.round((c/total)*1000)/10 : 0; // 1 decimal
        document.getElementById('count-'+id).textContent = c;
        document.getElementById('percent-'+id).textContent = pct + '%';
        document.getElementById('bar-'+id).style.width = pct + '%';
      }
      document.getElementById('totalVotes').textContent = total;

      // leader
      const entries = Object.entries(state.counts).sort((a,b)=>b[1]-a[1]);
      const leaderId = entries[0][0], leaderVal = entries[0][1];
      const topPct = total ? Math.round((leaderVal/total)*1000)/10 : 0;
      
      // PERUBAHAN DI SINI
      let leaderName = '—';
      if (leaderVal > 0) {
          switch (leaderId) {
              case '1':
                  leaderName = 'Ariny';
                  break;
              case '2':
                  leaderName = 'Kaka';
                  break;
              case '3':
                  leaderName = 'Bagus';
                  break;
          }
      }
      document.getElementById('leader').textContent = leaderName;
      // AKHIR PERUBAHAN
      
      document.getElementById('topPercent').textContent = topPct + '%';

      renderChart();
    }

    function renderChart(){
      const canvas = document.getElementById('chart');
      const ctx = canvas.getContext('2d');
      const w = canvas.width = canvas.clientWidth * window.devicePixelRatio;
      const h = canvas.height = canvas.clientHeight * window.devicePixelRatio;

      ctx.clearRect(0,0,w,h);
      const pad = 30 * window.devicePixelRatio;
      const baseY = h - pad;
      const startX = pad, endX = w - pad;

      // grid
      ctx.strokeStyle = '#E8E2FF'; ctx.lineWidth = 1;
      for(let i=0;i<5;i++){
        const y = pad + i * ((baseY-pad)/4);
        ctx.beginPath(); ctx.moveTo(startX, y); ctx.lineTo(endX, y); ctx.stroke();
      }

      // bars
      const labels = ['1','2','3'];
      const values = labels.map((_,i)=>state.counts[i+1]||0);
      const maxVal = Math.max(1, ...values);
      const barW = (endX - startX) / (labels.length*1.8);
      const gap = barW * .8;

      const colors = [
        gradient(ctx, '#7B5DBB', '#B9A7E8'),
        gradient(ctx, '#8A6FD1', '#D6CBF5'),
        gradient(ctx, '#6F56B9', '#B9A7E8'),
      ];

      labels.forEach((lbl,i)=>{
        const x = startX + i*(barW+gap) + gap;
        const v = values[i];
        const bh = (v/maxVal) * (baseY-pad);
        const y = baseY - bh;

        ctx.fillStyle = colors[i];
        roundRect(ctx, x, y, barW, bh, 12*window.devicePixelRatio);
        ctx.fill();

        ctx.fillStyle = '#241B3C'; ctx.textAlign='center';
        ctx.font = `${12*window.devicePixelRatio}px Inter, Arial`;
        ctx.fillText(v, x + barW/2, y - 8);
        ctx.fillStyle = '#6F678A';
        ctx.fillText('No ' + lbl, x + barW/2, baseY + 16);
      });
    }

    // Helpers
    function roundRect(ctx, x, y, w, h, r){
      ctx.beginPath();
      ctx.moveTo(x+r, y);
      ctx.arcTo(x+w, y, x+w, y+h, r);
      ctx.arcTo(x+w, y+h, x, y+h, r);
      ctx.arcTo(x, y+h, x, y, r);
      ctx.arcTo(x, y, x+w, y, r);
      ctx.closePath();
    }
    function gradient(ctx, from, to){
      const g = ctx.createLinearGradient(0,0,0,200);
      g.addColorStop(0, from); g.addColorStop(1, to); return g;
    }

    // Toast
    function toast(msg, kind='ok'){
      const el = document.createElement('div');
      el.className='toast';
      el.textContent = msg;
      el.style.background = kind==='warn' ? 'var(--danger)' : 'var(--success)';
      document.body.appendChild(el);
      setTimeout(()=> el.remove(), 1800);
    }

    window.addEventListener('resize', renderChart);
  </script>
</body>
</html>
